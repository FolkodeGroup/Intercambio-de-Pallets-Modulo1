{% extends 'base.html' %}
{% load static %}

{% block head %}
    <!-- Mismo CSS que el módulo de movimientos para que se vea idéntico -->
    <link rel="stylesheet" href="{% static 'registrar_egreso/registrar_egreso.css' %}">
    <script src="{% static 'registrar_egreso/registrar_egreso.js' %}"></script>
{% endblock %}

{% block content %}
<div class="movimientos-container">
  {% include 'includes/sidebar.html' %}

  <main class="movimientos-main">
    
    <section class="movimientos-main-section">
      <!-- Título igual al de “Ingresar Movimiento” -->
      <div class="section-title-container">
        <h4 class="movimientos-main-title">Nuevo Egreso</h4>
      </div>
      <hr class="bar">
      <form id="formEgreso" method="post" style="color:#ffffff;">
        {% csrf_token %}

        <!-- === PANEL 1: Datos del Egreso (misma tarjeta/colores) === -->
        <fieldset class="detalle-datos">

          <!-- Mismo layout de 2 columnas -->
          <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 50px;">
            <p>
              <label>Cliente:</label>
              {{ movimiento_form.empresa }}
            </p>

            <p>
              <label>Ubicación de Origen:</label>
              {{ movimiento_form.ubicacion_origen }}
            </p>

            <p>
              <label>Ubicación de Destino:</label>
              {{ movimiento_form.ubicacion_destino }}
            </p>

            <p>
              <label>Número de Remito / Documento:</label>
              {{ movimiento_form.doc_referencia }}
            </p>
          </div>

          <div style="margin-top:1rem;">
            <label>Observaciones:</label>
            {{ movimiento_form.observaciones }}
          </div>

          <!-- Si existe 'tipo' en el form, lo dejamos oculto (OUT) -->
          {% if movimiento_form.tipo %}{{ movimiento_form.tipo }}{% endif %}
        </fieldset>

        <!-- === PANEL 2: Líneas de Egreso === -->
        <fieldset class="detalle-movimiento">
          <legend style="color:#3B3737; font-weight:bold; font-size:1.5rem; margin-bottom:0.75rem;">
            Detalle de Pallets
          </legend>

          {{ formset.management_form }}

          {% for form in formset %}
            <div class="linea" style="margin-bottom:1rem; padding:0.75rem; background-color:#0D7A7F; border-radius:4px;">
              {{ form.as_p }}
            </div>
          {% endfor %}
        </fieldset>

        <!-- Botón centrado como en ingreso -->
        <div  class="btns-nav-container" style="text-align: end; margin-top: 1.5rem;">
            <button type="button" id="btn-back" class="btn btn-success" style="background-color: #002D33; border: none; padding: 0.5rem 1.5rem; font-size: 1rem; color: white; border-radius: 4px;">
                Volver
            </button>
            <button id="btn-egreso"
                type="submit"
                class="btn btn-success"
                style="background-color:#002D33; border:none; padding:0.5rem 1.5rem; font-size:1rem; color:white; border-radius:4px;"
                onclick="return confirmarEgreso();">
              Guardar Egreso
            </button>
            <button type="submit" name="btn-remito" id="btn-remito" class="btn btn-success" style="background-color: #002D33; border: none; padding: 0.5rem 1.5rem; font-size: 1rem; color: white; border-radius: 4px;">
                Generar Remito

            </button>
        </div>
        
      </form>
    </section>
  </main>
</div>

{% endblock %}
