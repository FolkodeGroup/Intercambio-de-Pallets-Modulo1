{% extends 'base.html' %}
{% load static %}

{% block head %}
    <link rel="stylesheet" href="{% static 'vista_empleados/vista_empleados.css'%}">
    <script src="{% static 'vista_empleados/vista_empleados.js' %}"></script>
{% endblock %}

{% block content %}
<div class="content-container">
    <main class="main">
        <h4 class="mb-4 main-title">Gestión de empleados</h4>
        
        <nav class="d-flex justify-content-between align-items-center mb-4">
            {# --- CAMBIO 1: Formulario de búsqueda funcional --- #}
            {# Se añade method="GET" para que la búsqueda se envíe por la URL #}
            <form class="w-auto" method="GET">
                <div class="input-group">
                    <span class="input-group-text">
                        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-search"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0" /><path d="M21 21l-6 -6" /></svg>
                    </span>
                    {# Se añade name="q" para que la vista pueda leer lo que el usuario busca #}
                    <input
                        class="form-control text-dark fw-bold"
                        type="search"
                        name="q"
                        placeholder="Buscar..." 
                        value="{{ request.GET.q }}"> {# Mantiene el texto buscado en la caja #}
                </div>
            </form>

            {# --- CAMBIO 2: El botón ahora apunta a la URL de creación --- #}
            <a href="{% url 'crear_empleado' %}" class="btn btn-primary btn-operation">+ Nuevo empleado</a>
        </nav>
        
        <div class="title-table-container">
            <h6 class="title-table">Empleados</h6>
        </div>
        <div class="table-wrapper">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr class="table-content-cels">
                        <th class="text-dark">Apellido</th>
                        <th class="text-dark">Nombre</th>
                        <th class="text-dark">DNI</th>
                        <th class="text-dark">Teléfono</th>
                        <th class="text-dark">Usuario</th>
                        <th class="text-end">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {# --- CAMBIO 3: Bucle para mostrar los empleados reales --- #}
                    {# Iteramos sobre la lista 'empleados' que pasamos desde la vista #}
                    {% for empleado in empleados %}
                    
                    <tr class="table-content-cels">
                        <td>{{ empleado.last_name }}</td>
                        <td>{{ empleado.first_name }}</td>
                        <td>{{ empleado.dni }}</td>
                        <td>{{ empleado.telefono|default:"N/A" }}</td> {# default:"N/A" por si no tiene teléfono #}
                        <td>{{ empleado.username }}</td>
                        <td class="text-end">
                            {# Aquí irían los botones para editar o eliminar #}
                            <button class="btn-cel-actions" data-menu="menuCelActions" style="background-color: transparent; border: none;">
                                <svg xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 -960 960 960" width="30px" fill="#e3e3e3"><path d="M480-160q-33 0-56.5-23.5T400-240q0-33 23.5-56.5T480-320q33 0 56.5 23.5T560-240q0 33-23.5 56.5T480-160Zm0-240q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm0-240q-33 0-56.5-23.5T400-720q0-33 23.5-56.5T480-800q33 0 56.5 23.5T560-720q0 33-23.5 56.5T480-640Z"/></svg>
                            </button>
                            <div class="menu-cel-actions" id="menu-cel-actions">
                                <a href="#" class="btn btn-sm btn-outline-secondary">
                                    <span>Editar usuario</span>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                    {% if not empleados %}
                    {# Esto se muestra si la lista 'empleados' está vacía #}
                    <tr>
                        <td colspan="6" class="text-center py-4">No se encontraron empleados.</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
         <!-- Ver más / Paginación -->
        <div class="text-center my-1">
            <button id="btn-more" class="btn btn-outline-light btn-more" style="background-color: #002D33">Ver más</button>
        </div>
        {# Aquí podrías agregar la lógica de paginación si la necesitas en el futuro #}

    </main>
</div>
{% endblock %}
